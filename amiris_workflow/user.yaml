action_folder: '../actions'

from_check_point: start

debug:
  time_it: False
  enable_development_mode: False
  log_level: DEBUG

global:
  pbDir: "amiris/result/"
  pbFile: traderes.pb
  output:
    filePath: amiris-config/data/
    timeSeriesDateFormat: '%Y-%m-%d_%H:%M:%S'
    pbOutputRaw: "output/raw/"
    pbOutputProcessed: "output/"
    csvSeparator: ";"

directives:
  translationFieldMap: 'amiris-config/translationFieldMap.yaml'

workflow:
  - action:
      project: general
      call: parse_excel
      data:
        read_from_dmgr: null
        write_to_dmgr: powerPlants
      args:
        excelFile: ../amiris_data_structure.xlsx
        excelSheet: conventionals
        excelHeader: True

  - actionCheck:
      project: general
      call: checkpoint
      tag: parsedData

  # Add conventionals (append to scneario skeleton)
  - action:
      project: general
      call: write_AMIRIS_config
      data:
        read_from_dmgr: powerPlants
        write_to_dmgr: null
      args:
        AMIRISConfigFieldMap: amiris-config/conventionalsFieldMap.yaml
        templateFile: amiris-config/scenario_template.yaml
        outputFile: scenario.yaml

  # Add storages (append to scenario)
#  - action:
#      project: general
#      call: write_AMIRIS_config
#      data:
#        read_from_dmgr: powerPlants
#        write_to_dmgr: null
#      args:
#        AMIRISConfigFieldMap: amiris-config/storagesFieldMap.yaml
#        templateFile: amiris-config/data/scenario.yaml
#        outputFile: scenario.yaml
#
#  # Add renewables (append to scenario)
#  - action:
#      project: general
#      call: write_AMIRIS_config
#      data:
#        read_from_dmgr: powerPlants
#        write_to_dmgr: null
#      args:
#        AMIRISConfigFieldMap: amiris-config/conventionalsFieldMap.yaml
#        templateFile: amiris-config/data/scenario.yaml
#        outputFile: scenario.yaml

  - action:
      project: general
      call: create_AMIRIS_protobuf
      args:
        input: amiris-config/data/scenario.yaml
        output: amiris-config/config.pb

  - action:
      project: general
      call: run_AMIRIS
      args:
        input: "amiris-config/config.pb"
        model:
          jar: 'amiris/amiris-core_1.2-jar-with-dependencies.jar'
          vm: '-ea -Xmx2000M'
          fame_args: '-Dlog4j.configuration=file:amiris/log4j.properties'
          runner: 'de.dlr.gitlab.fame.setup.FameRunner'
          fame_setup: 'amiris/fameSetup.yaml'

  - action:
      project: general
      call: convert_pb
